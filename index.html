<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Green Haze â€” This Week</title>
  <style>
    :root{--bg:#0b0f14;--card:#121821;--text:#e6edf3;--muted:#9fb0c3;--accent:#4ade80;--accent2:#60a5fa;--danger:#f87171}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,Segoe UI,Roboto}
    header{position:sticky;top:0;background:linear-gradient(180deg,#0b0f14 0%,rgba(11,15,20,0.8)100%);backdrop-filter:blur(6px);z-index:10}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    h1{margin:0;font-size:22px;font-weight:700}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .small{color:var(--muted);font-size:12px}

    .heat{display:flex;gap:10px;align-items:flex-end;height:120px;margin-top:10px}
    .col{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px}
    .bar{width:28px;border-radius:8px;background:linear-gradient(180deg,var(--accent),var(--accent2));transition:height .3s}
    .label{font-size:12px;color:var(--muted)}
    .counts{font-size:11px;color:var(--muted)}

    ul{list-style:none;margin:0;padding:0}
    li+li{border-top:1px solid #1f2937}
    .row{display:grid;grid-template-columns:auto 1fr auto;gap:12px;padding:10px 0;align-items:center}
    .badge{padding:4px 8px;border-radius:999px;font-weight:600;font-size:12px}
    .b-high{background:rgba(248,113,113,.15);color:var(--danger)}
    .b-med{background:rgba(96,165,250,.15);color:var(--accent2)}
    .b-low{background:rgba(74,222,128,.15);color:var(--accent)}
  </style>
</head>
<body>
  <header><div class="wrap"><h1>Green Haze</h1><div class="small">Heat by impact + Upcoming events</div></div></header>
  <main class="wrap">
    <div class="grid">
      <section class="card">
        <h2 style="margin:0 0 8px 0">Heatbar</h2>
        <div id="heatbar" class="heat"></div>
      </section>
      <section class="card">
        <h2 style="margin:0 0 8px 0">Next Events</h2>
        <ul id="list"></ul>
      </section>
    </div>
  </main>

  <script>
    const API_BASE = 'https://green-haze.mikaelalexiou.workers.dev';

    async function loadHeat() {
      const r = await fetch(`${API_BASE}/heatbar`);
      const j = await r.json();
      const root = document.getElementById('heatbar');
      root.innerHTML = '';
      const max = Math.max(1, ...j.days.map(d => d.score));
      const weekday = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      j.days.forEach((d, i) => {
        const col = document.createElement('div');
        col.className = 'col';
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = `${(d.score / max) * 100}px`;
        col.appendChild(bar);
        const counts = document.createElement('div');
        counts.className = 'counts';
        counts.textContent = `H${d.high} M${d.med} L${d.low}`;
        col.appendChild(counts);
        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = weekday[i];
        col.appendChild(label);
        root.appendChild(col);
      });
    }

    async function loadEvents() {
      const r = await fetch(`${API_BASE}/upcoming?limit=12`);
      const j = await r.json();
      const ul = document.getElementById('list');
      ul.innerHTML = '';
      (j.events || []).forEach(ev => {
        const li = document.createElement('li');
        const t = new Date(ev.datetime);
        const badge = ev.impact === 'High' ? 'b-high' : ev.impact === 'Medium' ? 'b-med' : 'b-low';
        li.innerHTML = `
          <div class="row">
            <div class="small">${t.toLocaleString([], { hour:'2-digit', minute:'2-digit'})}<br>${t.toLocaleDateString()}</div>
            <div><div style="font-weight:600">${ev.title}</div><div class="small">${ev.country}</div></div>
            <div class="badge ${badge}">${ev.impact}</div>
          </div>`;
        ul.appendChild(li);
      });
    }

    loadHeat();
    loadEvents();
  </script>
</body>
</html>
